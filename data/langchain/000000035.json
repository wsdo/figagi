{
	"title": "Synthetic data generation | ü¶úÔ∏èüîó Langchain",
	"url": "https://python.langchain.com/docs/use_cases/data_generation",
	"html": "Skip to main content\nü¶úÔ∏èüîó LangChain\nDocs\nUse cases\nIntegrations\nGuides\nAPI\nMore\nü¶úÔ∏èüîó\nChat\nSearch\n‚åò\nK\nQA over structured data\nSQL\nRetrieval-augmented generation (RAG)\nInteracting with APIs\nChatbots\nExtraction\nSummarization\nTagging\nWeb scraping\nSynthetic data generation\nGraph querying\nSynthetic data generation\nSynthetic data generation\n\nOpen In Colab\n\nUse case‚Äã\n\nSynthetic data is artificially generated data, rather than data collected from real-world events. It‚Äôs used to simulate real data without compromising privacy or encountering real-world limitations.\n\nBenefits of Synthetic Data:\n\nPrivacy and Security: No real personal data at risk of breaches.\nData Augmentation: Expands datasets for machine learning.\nFlexibility: Create specific or rare scenarios.\nCost-effective: Often cheaper than real-world data collection.\nRegulatory Compliance: Helps navigate strict data protection laws.\nModel Robustness: Can lead to better generalizing AI models.\nRapid Prototyping: Enables quick testing without real data.\nControlled Experimentation: Simulate specific conditions.\nAccess to Data: Alternative when real data isn‚Äôt available.\n\nNote: Despite the benefits, synthetic data should be used carefully, as it may not always capture real-world complexities.\n\nQuickstart‚Äã\n\nIn this notebook, we‚Äôll dive deep into generating synthetic medical billing records using the langchain library. This tool is particularly useful when you want to develop or test algorithms but don‚Äôt want to use real patient data due to privacy concerns or data availability issues.\n\nSetup‚Äã\n\nFirst, you‚Äôll need to have the langchain library installed, along with its dependencies. Since we‚Äôre using the OpenAI generator chain, we‚Äôll install that as well. Since this is an experimental lib, we‚Äôll need to include langchain_experimental in our installs. We‚Äôll then import the necessary modules.\n\n!pip install -U langchain langchain_experimental openai\n# Set env var OPENAI_API_KEY or load from a .env file:\n# import dotenv\n# dotenv.load_dotenv()\n\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.prompts import FewShotPromptTemplate, PromptTemplate\nfrom langchain.pydantic_v1 import BaseModel\nfrom langchain_experimental.tabular_synthetic_data.openai import (\n    OPENAI_TEMPLATE,\n    create_openai_data_generator,\n)\nfrom langchain_experimental.tabular_synthetic_data.prompts import (\n    SYNTHETIC_FEW_SHOT_PREFIX,\n    SYNTHETIC_FEW_SHOT_SUFFIX,\n)\n\n1. Define Your Data Model‚Äã\n\nEvery dataset has a structure or a ‚Äúschema‚Äù. The MedicalBilling class below serves as our schema for the synthetic data. By defining this, we‚Äôre informing our synthetic data generator about the shape and nature of data we expect.\n\nclass MedicalBilling(BaseModel):\n    patient_id: int\n    patient_name: str\n    diagnosis_code: str\n    procedure_code: str\n    total_charge: float\n    insurance_claim_amount: float\n\n\nFor instance, every record will have a patient_id that‚Äôs an integer, a patient_name that‚Äôs a string, and so on.\n\n2. Sample Data‚Äã\n\nTo guide the synthetic data generator, it‚Äôs useful to provide it with a few real-world-like examples. These examples serve as a ‚Äúseed‚Äù - they‚Äôre representative of the kind of data you want, and the generator will use them to create more data that looks similar.\n\nHere are some fictional medical billing records:\n\nexamples = [\n    {\n        \"example\": \"\"\"Patient ID: 123456, Patient Name: John Doe, Diagnosis Code: \n        J20.9, Procedure Code: 99203, Total Charge: $500, Insurance Claim Amount: $350\"\"\"\n    },\n    {\n        \"example\": \"\"\"Patient ID: 789012, Patient Name: Johnson Smith, Diagnosis \n        Code: M54.5, Procedure Code: 99213, Total Charge: $150, Insurance Claim Amount: $120\"\"\"\n    },\n    {\n        \"example\": \"\"\"Patient ID: 345678, Patient Name: Emily Stone, Diagnosis Code: \n        E11.9, Procedure Code: 99214, Total Charge: $300, Insurance Claim Amount: $250\"\"\"\n    },\n]\n\n3. Craft a Prompt Template‚Äã\n\nThe generator doesn‚Äôt magically know how to create our data; we need to guide it. We do this by creating a prompt template. This template helps instruct the underlying language model on how to produce synthetic data in the desired format.\n\nOPENAI_TEMPLATE = PromptTemplate(input_variables=[\"example\"], template=\"{example}\")\n\nprompt_template = FewShotPromptTemplate(\n    prefix=SYNTHETIC_FEW_SHOT_PREFIX,\n    examples=examples,\n    suffix=SYNTHETIC_FEW_SHOT_SUFFIX,\n    input_variables=[\"subject\", \"extra\"],\n    example_prompt=OPENAI_TEMPLATE,\n)\n\n\nThe FewShotPromptTemplate includes:\n\nprefix and suffix: These likely contain guiding context or instructions.\nexamples: The sample data we defined earlier.\ninput_variables: These variables (‚Äúsubject‚Äù, ‚Äúextra‚Äù) are placeholders you can dynamically fill later. For instance, ‚Äúsubject‚Äù might be filled with ‚Äúmedical_billing‚Äù to guide the model further.\nexample_prompt: This prompt template is the format we want each example row to take in our prompt.\n4. Creating the Data Generator‚Äã\n\nWith the schema and the prompt ready, the next step is to create the data generator. This object knows how to communicate with the underlying language model to get synthetic data.\n\nsynthetic_data_generator = create_openai_data_generator(\n    output_schema=MedicalBilling,\n    llm=ChatOpenAI(\n        temperature=1\n    ),  # You'll need to replace with your actual Language Model instance\n    prompt=prompt_template,\n)\n\n5. Generate Synthetic Data‚Äã\n\nFinally, let‚Äôs get our synthetic data!\n\nsynthetic_results = synthetic_data_generator.generate(\n    subject=\"medical_billing\",\n    extra=\"the name must be chosen at random. Make it something you wouldn't normally choose.\",\n    runs=10,\n)\n\n\nThis command asks the generator to produce 10 synthetic medical billing records. The results are stored in synthetic_results. The output will be a list of the MedicalBilling pydantic models.\n\nOther implementations‚Äã\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain_experimental.synthetic_data import (\n    DatasetGenerator,\n    create_data_generation_chain,\n)\n\n# LLM\nmodel = ChatOpenAI(model_name=\"gpt-3.5-turbo\", temperature=0.7)\nchain = create_data_generation_chain(model)\n\nchain({\"fields\": [\"blue\", \"yellow\"], \"preferences\": {}})\n\n{'fields': ['blue', 'yellow'],\n 'preferences': {},\n 'text': 'The vibrant blue sky contrasted beautifully with the bright yellow sun, creating a stunning display of colors that instantly lifted the spirits of all who gazed upon it.'}\n\nchain(\n    {\n        \"fields\": {\"colors\": [\"blue\", \"yellow\"]},\n        \"preferences\": {\"style\": \"Make it in a style of a weather forecast.\"},\n    }\n)\n\n{'fields': {'colors': ['blue', 'yellow']},\n 'preferences': {'style': 'Make it in a style of a weather forecast.'},\n 'text': \"Good morning! Today's weather forecast brings a beautiful combination of colors to the sky, with hues of blue and yellow gently blending together like a mesmerizing painting.\"}\n\nchain(\n    {\n        \"fields\": {\"actor\": \"Tom Hanks\", \"movies\": [\"Forrest Gump\", \"Green Mile\"]},\n        \"preferences\": None,\n    }\n)\n\n{'fields': {'actor': 'Tom Hanks', 'movies': ['Forrest Gump', 'Green Mile']},\n 'preferences': None,\n 'text': 'Tom Hanks, the renowned actor known for his incredible versatility and charm, has graced the silver screen in unforgettable movies such as \"Forrest Gump\" and \"Green Mile\".'}\n\nchain(\n    {\n        \"fields\": [\n            {\"actor\": \"Tom Hanks\", \"movies\": [\"Forrest Gump\", \"Green Mile\"]},\n            {\"actor\": \"Mads Mikkelsen\", \"movies\": [\"Hannibal\", \"Another round\"]},\n        ],\n        \"preferences\": {\"minimum_length\": 200, \"style\": \"gossip\"},\n    }\n)\n\n{'fields': [{'actor': 'Tom Hanks', 'movies': ['Forrest Gump', 'Green Mile']},\n  {'actor': 'Mads Mikkelsen', 'movies': ['Hannibal', 'Another round']}],\n 'preferences': {'minimum_length': 200, 'style': 'gossip'},\n 'text': 'Did you know that Tom Hanks, the beloved Hollywood actor known for his roles in \"Forrest Gump\" and \"Green Mile\", has shared the screen with the talented Mads Mikkelsen, who gained international acclaim for his performances in \"Hannibal\" and \"Another round\"? These two incredible actors have brought their exceptional skills and captivating charisma to the big screen, delivering unforgettable performances that have enthralled audiences around the world. Whether it\\'s Hanks\\' endearing portrayal of Forrest Gump or Mikkelsen\\'s chilling depiction of Hannibal Lecter, these movies have solidified their places in cinematic history, leaving a lasting impact on viewers and cementing their status as true icons of the silver screen.'}\n\n\nAs we can see created examples are diversified and possess information we wanted them to have. Also, their style reflects the given preferences quite well.\n\nGenerating exemplary dataset for extraction benchmarking purposes‚Äã\ninp = [\n    {\n        \"Actor\": \"Tom Hanks\",\n        \"Film\": [\n            \"Forrest Gump\",\n            \"Saving Private Ryan\",\n            \"The Green Mile\",\n            \"Toy Story\",\n            \"Catch Me If You Can\",\n        ],\n    },\n    {\n        \"Actor\": \"Tom Hardy\",\n        \"Film\": [\n            \"Inception\",\n            \"The Dark Knight Rises\",\n            \"Mad Max: Fury Road\",\n            \"The Revenant\",\n            \"Dunkirk\",\n        ],\n    },\n]\n\ngenerator = DatasetGenerator(model, {\"style\": \"informal\", \"minimal length\": 500})\ndataset = generator(inp)\n\ndataset\n\n[{'fields': {'Actor': 'Tom Hanks',\n   'Film': ['Forrest Gump',\n    'Saving Private Ryan',\n    'The Green Mile',\n    'Toy Story',\n    'Catch Me If You Can']},\n  'preferences': {'style': 'informal', 'minimal length': 500},\n  'text': 'Tom Hanks, the versatile and charismatic actor, has graced the silver screen in numerous iconic films including the heartwarming and inspirational \"Forrest Gump,\" the intense and gripping war drama \"Saving Private Ryan,\" the emotionally charged and thought-provoking \"The Green Mile,\" the beloved animated classic \"Toy Story,\" and the thrilling and captivating true story adaptation \"Catch Me If You Can.\" With his impressive range and genuine talent, Hanks continues to captivate audiences worldwide, leaving an indelible mark on the world of cinema.'},\n {'fields': {'Actor': 'Tom Hardy',\n   'Film': ['Inception',\n    'The Dark Knight Rises',\n    'Mad Max: Fury Road',\n    'The Revenant',\n    'Dunkirk']},\n  'preferences': {'style': 'informal', 'minimal length': 500},\n  'text': 'Tom Hardy, the versatile actor known for his intense performances, has graced the silver screen in numerous iconic films, including \"Inception,\" \"The Dark Knight Rises,\" \"Mad Max: Fury Road,\" \"The Revenant,\" and \"Dunkirk.\" Whether he\\'s delving into the depths of the subconscious mind, donning the mask of the infamous Bane, or navigating the treacherous wasteland as the enigmatic Max Rockatansky, Hardy\\'s commitment to his craft is always evident. From his breathtaking portrayal of the ruthless Eames in \"Inception\" to his captivating transformation into the ferocious Max in \"Mad Max: Fury Road,\" Hardy\\'s dynamic range and magnetic presence captivate audiences and leave an indelible mark on the world of cinema. In his most physically demanding role to date, he endured the harsh conditions of the freezing wilderness as he portrayed the rugged frontiersman John Fitzgerald in \"The Revenant,\" earning him critical acclaim and an Academy Award nomination. In Christopher Nolan\\'s war epic \"Dunkirk,\" Hardy\\'s stoic and heroic portrayal of Royal Air Force pilot Farrier showcases his ability to convey deep emotion through nuanced performances. With his chameleon-like ability to inhabit a wide range of characters and his unwavering commitment to his craft, Tom Hardy has undoubtedly solidified his place as one of the most talented and sought-after actors of his generation.'}]\n\nExtraction from generated examples‚Äã\n\nOkay, let‚Äôs see if we can now extract output from this generated data and how it compares with our case!\n\nfrom typing import List\n\nfrom langchain.chains import create_extraction_chain_pydantic\nfrom langchain.llms import OpenAI\nfrom langchain.output_parsers import PydanticOutputParser\nfrom langchain.prompts import PromptTemplate\nfrom pydantic import BaseModel, Field\n\nclass Actor(BaseModel):\n    Actor: str = Field(description=\"name of an actor\")\n    Film: List[str] = Field(description=\"list of names of films they starred in\")\n\nParsers‚Äã\nllm = OpenAI()\nparser = PydanticOutputParser(pydantic_object=Actor)\n\nprompt = PromptTemplate(\n    template=\"Extract fields from a given text.\\n{format_instructions}\\n{text}\\n\",\n    input_variables=[\"text\"],\n    partial_variables={\"format_instructions\": parser.get_format_instructions()},\n)\n\n_input = prompt.format_prompt(text=dataset[0][\"text\"])\noutput = llm(_input.to_string())\n\nparsed = parser.parse(output)\nparsed\n\nActor(Actor='Tom Hanks', Film=['Forrest Gump', 'Saving Private Ryan', 'The Green Mile', 'Toy Story', 'Catch Me If You Can'])\n\n(parsed.Actor == inp[0][\"Actor\"]) & (parsed.Film == inp[0][\"Film\"])\n\nTrue\n\nExtractors‚Äã\nextractor = create_extraction_chain_pydantic(pydantic_schema=Actor, llm=model)\nextracted = extractor.run(dataset[1][\"text\"])\nextracted\n\n[Actor(Actor='Tom Hardy', Film=['Inception', 'The Dark Knight Rises', 'Mad Max: Fury Road', 'The Revenant', 'Dunkirk'])]\n\n(extracted[0].Actor == inp[1][\"Actor\"]) & (extracted[0].Film == inp[1][\"Film\"])\n\nTrue\n\nPrevious\nWeb scraping\nNext\nGraph querying\nUse case\nQuickstart\nSetup\n1. Define Your Data Model\n2. Sample Data\n3. Craft a Prompt Template\n4. Creating the Data Generator\n5. Generate Synthetic Data\nOther implementations\nGenerating exemplary dataset for extraction benchmarking purposes\nExtraction from generated examples\nParsers\nExtractors\nCommunity\nDiscord\nTwitter\nGitHub\nPython\nJS/TS\nMore\nHomepage\nBlog\nCopyright ¬© 2023 LangChain, Inc."
}